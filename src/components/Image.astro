---
// https://jcbl.ws/astro-vercel-image-optimization
export interface Props extends astroHTML.JSX.ImgHTMLAttributes {
  src: string
  alt: string
  quality?: number
  width?: 640 | 750 | 828 | 1080 | 1200 // image sizes we generate in the config
}

const { src, alt, quality = 75, width = 828, ...rest } = Astro.props
const optimizedURL =
  import.meta.env.MODE === 'production' // this will only run in production
    ? `/_vercel/image?url=${encodeURIComponent(src)}&w=${width}&q=${quality}`
    : src
---

<img loading="lazy" src={optimizedURL} alt={alt} {...rest} />